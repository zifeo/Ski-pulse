#!/usr/bin/env python3
import requests
import os

lat = '46.097236'
lg = '7.228231'

def get_weather_for_date(date, api_key):
    time = '06:00:00' # only one time is needed, the json contains the whole day !
    request_text = 'https://api.forecast.io/forecast/' + api_key + '/' + lat + ',' + lg + ',' + date + 'T' + time
    request = requests.get(request_text)
    if request.status_code != 200:
        raise Exception('An error occured.')
    return (date, request.json())

#def load_dates():
#    def get_date(line):
#        parts = line.split(';')
#        date = parts[0]
#        ds = date.split('.')
#        d = ds[0]
#        m = ds[1]
#        y = ds[2]
#        return '\'20{}-{}-{}\''.format(y, m, d)
#
#    path_to_csv = '../../datasets/ticketing/verbier-le-chable.csv'
#    input_file = open(path_to_csv, 'r', encoding='ISO-8859-1')
#    dates = []
#    last_date = None
#    first_line = True
#    for line in input_file:
#        if first_line:
#            first_line = False
#            continue
#        line_date = get_date(line)
#        if last_date != line_date:
#            last_date = line_date
#            dates.append(last_date)
#    input_file.close()
#    return dates

dates = [
'2015-11-30',
'2015-12-01',
'2015-12-02',
'2015-12-03',
'2015-12-04',
'2015-12-05',
'2015-12-06',
'2015-12-07',
'2015-12-08',
'2015-12-09',
'2015-12-10',
'2015-12-11',
'2015-12-12',
'2015-12-13',
'2015-12-14',
'2015-12-15',
'2015-12-16',
'2015-12-17',
'2015-12-18',
'2015-12-19',
'2015-12-20',
'2015-12-21',
'2015-12-22',
'2015-12-23',
'2015-12-24',
'2015-12-25',
'2015-12-26',
'2015-12-27',
'2015-12-28',
'2015-12-29',
'2015-12-30',
'2015-12-31',
'2016-01-01',
'2016-01-02',
'2016-01-03',
'2016-01-04',
'2016-01-05',
'2016-01-06',
'2016-01-07',
'2016-01-08',
'2016-01-09',
'2016-01-10',
'2016-01-11',
'2016-01-12',
'2016-01-13',
'2016-01-14',
'2016-01-15',
'2016-01-16',
'2016-01-17',
'2016-01-18',
'2016-01-19',
'2016-01-20',
'2016-01-21',
'2016-01-22',
'2016-01-23',
'2016-01-24',
'2016-01-25',
'2016-01-26',
'2016-01-27',
'2016-01-28',
'2016-01-29',
'2016-01-30',
'2016-01-31',
'2016-02-01',
'2016-02-02',
'2016-02-03',
'2016-02-04',
'2016-02-05',
'2016-02-06',
'2016-02-07',
'2016-02-08',
'2016-02-09',
'2016-02-10',
'2016-02-11',
'2016-02-12',
'2016-02-13',
'2016-02-14',
'2016-02-15',
'2016-02-16',
'2016-02-17',
'2016-02-18',
'2016-02-19',
'2016-02-20',
'2016-02-21',
'2016-02-22',
'2016-02-23',
'2016-02-24',
'2016-02-25',
'2016-02-26',
'2016-02-27',
'2016-02-28',
'2016-02-29',
'2016-03-01',
'2016-03-02',
'2016-03-03',
'2016-03-04',
'2016-03-05',
'2016-03-06',
'2016-03-07',
'2016-03-08',
'2016-03-09',
'2016-03-10',
'2016-03-11',
'2016-03-12',
'2016-03-13',
'2016-03-14',
'2016-03-15',
'2016-03-16',
'2016-03-17',
'2016-03-18',
'2016-03-19',
'2016-03-20',
'2016-03-21',
'2016-03-22',
'2016-03-23',
'2016-03-24',
'2016-03-25',
'2016-03-26',
'2016-03-27',
'2016-03-28',
'2016-03-29',
'2016-03-30',
'2016-03-31',
'2016-04-01',
'2016-04-02',
'2016-04-03',
'2016-04-04',
'2016-04-05',
'2016-04-06',
'2016-04-07',
'2016-04-08',
'2016-04-09',
'2016-04-10',
'2016-04-11',
'2016-04-12',
'2016-04-13',
'2016-04-14',
'2016-04-15',
'2016-04-16',
'2016-04-17',
'2016-04-18',
'2016-04-19',
'2016-04-20',
'2016-04-21',
'2016-04-22',
'2016-04-23']        

def load_API_key():
    # Super secret key
    f = open('/home/jbouron/FW-APIkey.key', 'r')
    key = f.readline().replace('\n', '')
    f.close()
    return key

if __name__ == '__main__':
    key = load_API_key()
    for d in dates:
        _d, _json=get_weather_for_date(d, key)
        print(_d)
        print(_json)
